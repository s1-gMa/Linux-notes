---
tags:
  - IO
---
## 5.1 输入系统框架 

用户态通过 `/dev/input/eventX` 读取输入事件,内核中由各个输入设备驱动上报事件,经 input 子系统统一管理与分发.

![[4 5.1输入系统框架.png]]

## 5.2 APP 获取的输入事件结构体(type / code / value) #input_API

用户程序从 `/dev/input/eventX` 中读取到的输入数据,一般是一个 `input_event` 结构体,主要字段包括:

- `type`:事件类型
  - 例如:按键类,相对位移类,绝对坐标类等
- `code`:子类具体编码
  - 例如:`REL_X`,`REL_Y`,`ABS_X`,某个具体按键编码等
- `value`:事件值
  - 对按键来说:1 表示按下,0 表示松开
  - 对位移/坐标来说:表示偏移值或位置
  - 对压力来说:表示压力大小
![[4 5.2输入数据结构体.png]]

完整的一次输入操作往往由多条事件组成.发送完一组事件后,内核会再上报一个同步事件(如 `SYN_REPORT` 图示为发送一串`0000`),告诉用户程序"这一组事件结束了,下一条开始是下一组数据".

示意图占位:

![[4 5.2触摸屏的输入事件数据.png]]

## 5.3 调试技巧

常用调试命令:
	`ls /dev/input/* -l` **查看有哪些设备节点**
	`cat /proc/bus/input/devices` **查看不同设备节点分别对应什么硬件**
![[4 5.3调试查看设备.png]]
可以配合 `hexdump`,`od`,`evtest` 等工具观察事件数据.

## 5.4 输入系统相关 API

用户态常用 API:

- `open()` 打开 `/dev/input/eventX`
- `read()` 循环读取 `input_event` 结构体
- `ioctl()` 查询或设置某些设备属性
