---
tags:
  - IO
---
## 3.1 文件 IO 函数分类

使用**POSIX**接口 从而可以在不同版本的Linux Unix发行版运行

常见分类:

- 1.**标准 IO**:
  - `fopen`,`fread`,`fwrite`,`fseek`,`fflush`,`fclose` 等
  - 使用用户态缓冲区,提高读写效率
- 2.**系统调用 IO**:
  - `open`,`read`,`write`,`lseek`,`fsync`,`close` 等
  - 直接与内核交互,不做用户态缓冲

关系:

- 标准 IO 是在系统调用 IO 的基础上再封装一层用户缓冲区(),以减少频繁陷入内核的次数,从而提高效率.
- (只有第一次进入内核 后面在用户buffer中操作 如果用户buffer满了 调用系统IO写入硬件)
- ![[4 3.1标准IO和系统IO关系.png]]


## 3.2 系统调用接口 #IO_API

典型接口原型(仅作记忆用,可用 `man` 查详细):

    int open(const char *pathname, int flags, ...);
    ssize_t read(int fd, void *buf, size_t count);
    ssize_t write(int fd, const void *buf, size_t count);
    off_t lseek(int fd, off_t offset, int whence);
    int fsync(int fd);
    int close(int fd);

## 3.3 标准 IO 接口

常见函数原型:

    FILE *fopen(const char *pathname, const char *mode);
    size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream);
    size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream);
    int fseek(FILE *stream, long offset, int whence);
    int fflush(FILE *stream);
    int fclose(FILE *stream);

## 3.4 内部机制与用户缓冲区

缓冲模式大致包括:

- 全缓冲
- 行缓冲
- 无缓冲

注意:

- 调用 `fwrite` 写入的数据,通常先进入用户态缓冲区,可能不会立刻写入磁盘.
- 为保证数据及时写入,可以调用 `fflush` 或 `fclose`.
